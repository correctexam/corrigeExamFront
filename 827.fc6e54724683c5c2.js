(()=>{"use strict";var p,w={33827:(p,b,u)=>{var f=u(17156).default;const d=new Map;let i,h;const v=[];function N(){return(N=f(function*(s){try{console.error("cleanOutdatedCache for ",s);const e=s.payload.examIds,a=e.map(n=>n+".sqlite3"),t=e.map(n=>n+".sqlite3-journal");if(a.push(...t),void 0!==navigator.storage.getDirectory){const n=yield navigator.storage.getDirectory(),r=n.keys();let l=yield r.next();for(;l.value;)(l.value.endsWith(".sqlite3")||l.value.endsWith(".sqlite3-journal")&&!a.includes(l.value))&&(yield n.removeEntry(l.value)),l=yield r.next()}}finally{postMessage({msg:s.msg,uid:s.uid})}})).apply(this,arguments)}addEventListener("message",s=>{switch(s.data.msg){case"hello":postMessage({msg:`worker response to ${s.data.msg}`});break;case"shareWorker":{const e=s.data.port;e.onmessage=a=>{switch(a.data.msg){case"getFirstNonAlignImage":{let t=d.get(a.data.payload.examId);void 0===t&&(t=new m(a.data.payload.examId),t.initemptyDb(i),d.set(a.data.payload.examId,t)),t.getFirstNonAlignImage(i,a.data,e);break}case"getFirstAlignImage":{let t=d.get(a.data.payload.examId);void 0===t&&(t=new m(a.data.payload.examId),t.initemptyDb(i),d.set(a.data.payload.examId,t)),t.getFirstAlignImage(i,a.data,e);break}case"getFirstTemplate":{let t=d.get(a.data.payload.examId);void 0===t&&(t=new m(a.data.payload.examId),t.initemptyDb(i),d.set(a.data.payload.examId,t)),t.getFirstTemplate(i,a.data,e);break}case"getAllTemplate":{let t=d.get(a.data.payload.examId);void 0===t&&(t=new m(a.data.payload.examId),t.initemptyDb(i),d.set(a.data.payload.examId,t)),t.getAllTemplate(i,a.data,e);break}}},"-1"===s.data.uid?h=e:v.push(e);break}case"load":try{const e=self;e.Module={scriptUrl:"content/sqlite/sqlite3.js"},e.importScripts(e.Module.scriptUrl),e.sqlite3InitModule({print:console.log,printErr:console.error}).then(function(a){i=a,postMessage({msg:"databaseReady",uid:"0"}),h.postMessage({msg:"databaseReady",uid:"0"})})}finally{}break;case"addAligneImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),d.set(s.data.payload.examId,e)),e.addAligneImage(i,s.data);break}case"addNonAligneImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.addNonAligneImage(i,s.data);break}case"cleanOutDatedCached":!function I(s){N.apply(this,arguments)}(s.data);break;case"resetDatabase":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.resetDatabase(i,s.data);break}case"removeExam":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removeExam(i,s.data);break}case"removeElementForExam":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removeElementForExam(i,s.data);break}case"removePageAlignForExam":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageAlignForExam(i,s.data);break}case"removeElementForExamForPages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removeElementForExamForPages(i,s.data);break}case"removePageAlignForExamForPages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageAlignForExamForPages(i,s.data);break}case"removePageAlignForExamForPage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageAlignForExamForPage(i,s.data);break}case"removePageNonAlignForExamForPage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageNonAlignForExamForPage(i,s.data);break}case"removePageNonAlignForExamForPages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageNonAlignForExamForPages(i,s.data);break}case"export":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.export(i,s.data);break}case"import":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.import(i,s.data);break}case"countPageTemplate":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.countPageTemplate(i,s.data);break}case"countAlignImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.countAlignImage(i,s.data);break}case"countNonAlignImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.countNonAlignImage(i,s.data);break}case"getFirstNonAlignImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getFirstNonAlignImage(i,s.data);break}case"getFirstAlignImage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getFirstAlignImage(i,s.data);break}case"getFirstTemplate":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getFirstTemplate(i,s.data);break}case"getAllTemplate":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getAllTemplate(i,s.data);break}case"getNonAlignImageBetweenAndSortByPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getNonAlignImageBetweenAndSortByPageNumber(i,s.data);break}case"getAlignImageBetweenAndSortByPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getAlignImageBetweenAndSortByPageNumber(i,s.data);break}case"getNonAlignImagesForPageNumbers":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getNonAlignImagesForPageNumbers(i,s.data);break}case"getAlignImagesForPageNumbers":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getAlignImagesForPageNumbers(i,s.data);break}case"getNonAlignSortByPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getNonAlignSortByPageNumber(i,s.data);break}case"getAlignSortByPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getAlignSortByPageNumber(i,s.data);break}case"addExam":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.addExam(i,s.data);break}case"addTemplate":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.addTemplate(i,s.data);break}case"getExamTimestamp":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.getExamTimestamp(i,s.data);break}case"countNonAlignWithPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.countNonAlignWithPageNumber(i,s.data);break}case"countAlignWithPageNumber":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.countAlignWithPageNumber(i,s.data);break}case"moveNonAlignPages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.moveNonAlignPages(i,s.data);break}case"moveAlignPages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.moveAlignPages(i,s.data);break}case"removePageAlignForExamForPagesAndReorder":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageAlignForExamForPagesAndReorder(i,s.data);break}case"removePageNonAlignForExamForPagesAndReorder":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageNonAlignForExamForPagesAndReorder(i,s.data);break}case"moveTemplatePages":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.moveTemplatePages(i,s.data);break}case"removePageTemplateForExamForPage":{let e=d.get(s.data.payload.examId);void 0===e&&(e=new m(s.data.payload.examId),e.initemptyDb(i),d.set(s.data.payload.examId,e)),e.removePageTemplateForExamForPage(i,s.data);break}}});class m{examName;db;constructor(e){this.examName=e}error(...e){console.error(...e)}initDb(e){if(void 0===this.db||!this.db.isOpen()){const a=e.oo1;this.db=e.opfs?new a.OpfsDb("/"+this.examName+".sqlite3"):new a.DB("/"+this.examName+".sqlite3","ct")}}close(){this.db.close()}closeOther(){}initemptyDb(e){this.initDb(e);try{this.db.exec("CREATE TABLE IF NOT EXISTS template(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS align(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS nonalign(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("create table IF NOT EXISTS exam(id INTEGER NOT NULL PRIMARY KEY, DT datetime default current_timestamp)"),this.db.exec({sql:"INSERT OR IGNORE INTO exam(id) VALUES (?)",bind:[1]})}finally{this.close()}}addAligneImage(e,a){const t=a.payload;this.initDb(e);try{this.db.selectValue("select count(*) from align where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from align where page="+t.pageNumber});const n=new TextDecoder("utf-8"),r=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO align(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,n.decode(r)]})}finally{this.close(),postMessage({msg:a.msg,uid:a.uid})}}addNonAligneImage(e,a){const t=a.payload;this.initDb(e);try{this.db.selectValue("select count(*) from nonalign where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from nonalign where page="+t.pageNumber});const n=new TextDecoder("utf-8"),r=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO nonalign(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,n.decode(r)]})}finally{this.close(),postMessage({msg:a.msg,uid:a.uid})}}addTemplate(e,a){const t=a.payload;this.initDb(e);try{this.db.selectValue("select count(*) from template where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from template where page="+t.pageNumber});const n=new TextDecoder("utf-8"),r=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO template(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,n.decode(r)]})}finally{this.close(),postMessage({msg:a.msg,uid:a.uid})}}resetDatabase(e,a){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const n=yield navigator.storage.getDirectory(),r=n.keys();let l=yield r.next();for(;void 0!==l.value;)(l.value===t.examName+".sqlite3"||l.value===t.examName+"sqlite3-journal")&&(yield n.removeEntry(l.value)),l=yield r.next();t.initemptyDb(e)}}finally{postMessage({msg:a.msg,uid:a.uid})}})()}removeExam(e,a){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const n=yield navigator.storage.getDirectory(),r=n.keys();let l=yield r.next();for(;void 0!==l.value;)l.value===t.examName+".sqlite3"?yield n.removeEntry(t.examName+".sqlite3"):l.value===t.examName+".sqlite3-journal"&&(yield n.removeEntry(t.examName+".sqlite3-journal")),l=yield r.next();t.initemptyDb(e)}}finally{postMessage({msg:a.msg,uid:a.uid})}})()}removeElementForExam(e,a){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const n=yield navigator.storage.getDirectory(),r=n.keys();let l=yield r.next();for(;void 0!==l.value;)l.value===t.examName+".sqlite3"?yield n.removeEntry(t.examName+".sqlite3"):l.value===t.examName+".sqlite3-journal"&&(yield n.removeEntry(t.examName+".sqlite3-journal")),l=yield r.next();t.initemptyDb(e)}}finally{postMessage({msg:a.msg,uid:a.uid})}})()}removePageAlignForExam(e,a){this.initDb(e);try{this.db.exec("delete from align"),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}removeElementForExamForPages(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page>="+t.pageStart+" and page <= "+t.pageEnd),this.db.exec("delete from align where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}removePageAlignForExamForPages(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from align where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}removePageAlignForExamForPage(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from align where page="+t.page),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}removePageNonAlignForExamForPage(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page="+t.page),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}removePageNonAlignForExamForPages(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}export(e,a){var t=this;return f(function*(){if(void 0!==navigator.storage.getDirectory){const n=yield navigator.storage.getDirectory(),r=n.keys();let l=yield r.next();for(;void 0!==l.value;){if(l.value===t.examName+".sqlite3"){const g=yield(yield n.getFileHandle(t.examName+".sqlite3")).getFile(),y=yield g.arrayBuffer(),x=new Blob([new Uint8Array(y)],{type:g.type});postMessage({msg:a.msg,uid:a.uid,payload:x});break}l=yield r.next()}}else postMessage({msg:a.msg,uid:a.uid})})()}import(e,a){var t=this;return f(function*(){const r=a.payload.blob;if(void 0!==navigator.storage.getDirectory){const l=yield navigator.storage.getDirectory(),o=l.keys();let g=yield o.next();for(;void 0!==g.value;)g.value===t.examName+".sqlite3"?yield l.removeEntry(t.examName+".sqlite3"):g.value===t.examName+".sqlite3-journal"&&(yield l.removeEntry(t.examName+".sqlite3-journal")),g=yield o.next();const x=yield(yield l.getFileHandle(t.examName+".sqlite3",{create:!0})).createWritable();try{yield x.write(r)}finally{yield x.close()}}t.initDb(e),t.close(),postMessage({msg:a.msg,uid:a.uid})})()}countPageTemplate(e,a){this.initDb(e);try{const t=this.db.selectValue("select count(*) from template");postMessage({msg:a.msg,uid:a.uid,payload:t})}finally{this.close()}}countAlignImage(e,a){this.initDb(e);try{const t=this.db.selectValue("select count(*) from align");postMessage({msg:a.msg,uid:a.uid,payload:t})}finally{this.close()}}countNonAlignImage(e,a){this.initDb(e);try{const t=this.db.selectValue("select count(*) from nonalign");postMessage({msg:a.msg,uid:a.uid,payload:t})}finally{this.close()}}getFirstNonAlignImage(e,a,t){const n=a.payload;this.initDb(e);try{const r=this.db.selectValue("select imageData from nonalign where page="+n.pageInscan),o=(new TextEncoder).encode(r).buffer;t?t.postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o]):postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o])}finally{this.close()}}getFirstAlignImage(e,a,t){const n=a.payload;this.initDb(e);try{const r=this.db.selectValue("select imageData from align where page="+n.pageInscan),o=(new TextEncoder).encode(r).buffer;t?t.postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o]):postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o])}finally{this.close()}}getFirstTemplate(e,a,t){const n=a.payload;this.initDb(e);try{const r=this.db.selectValue("select imageData from template where page="+n.pageInscan),o=(new TextEncoder).encode(r).buffer;t?t.postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o]):postMessage({msg:a.msg,uid:a.uid,payload:{value:o,examId:n.examId,pageNumber:n.pageNumber}},[o])}finally{this.close()}}getAllTemplate(e,a,t){this.initDb(e);try{const n=this.db.selectArrays("select page,imageData from template order by page asc"),r=[],l=new TextEncoder,o=[];n.forEach(g=>{const y=l.encode(g[1]).buffer;o.push(y),r.push({pageNumber:g[0],examId:this.examName,value:y})}),t?t.postMessage({msg:a.msg,uid:a.uid,payload:r},o):postMessage({msg:a.msg,uid:a.uid,payload:r},o)}finally{this.close()}}getNonAlignImagesForPageNumbers(e,a){const t=a.payload;if(void 0!==t.pages&&void 0!==t.pages.joins){this.initDb(e);try{const n=this.db.selectArrays("select page,imageData from nonalign where page in ("+t.pages.join(",")+") order by page asc"),r=[],l=new TextEncoder,o=[];n.forEach(g=>{const y=l.encode(g[1]).buffer;o.push(y),r.push({pageNumber:g[0],examId:this.examName,value:y})}),postMessage({msg:a.msg,uid:a.uid,payload:r},o)}finally{this.close()}}else postMessage({msg:a.msg,uid:a.uid})}getAlignImagesForPageNumbers(e,a){const t=a.payload;if(void 0!==t.pages&&void 0!==t.pages.joins){this.initDb(e);try{const n=this.db.selectArrays("select page,imageData from align where page in ("+t.pages.join(",")+") order by page asc"),r=[],l=new TextEncoder,o=[];n.forEach(g=>{const y=l.encode(g[1]).buffer;o.push(y),r.push({pageNumber:g[0],examId:this.examName,value:y})}),postMessage({msg:a.msg,uid:a.uid,payload:r},o)}finally{this.close()}}else postMessage({msg:a.msg,uid:a.uid})}getNonAlignImageBetweenAndSortByPageNumber(e,a){const t=a.payload;this.initDb(e);try{const n=this.db.selectArrays("select page,imageData from nonalign where page>="+t.p1+" and page <= "+t.p2+" order by page asc"),r=[],l=new TextEncoder,o=[];n.forEach(g=>{const y=l.encode(g[1]).buffer;o.push(y),r.push({pageNumber:g[0],examId:this.examName,value:y})}),postMessage({msg:a.msg,uid:a.uid,payload:r},o)}finally{this.close()}}getAlignImageBetweenAndSortByPageNumber(e,a){const t=a.payload;this.initDb(e);try{const n=this.db.selectArrays("select page,imageData from align where page>="+t.p1+" and page <= "+t.p2+" order by page asc"),r=[],l=new TextEncoder,o=[];n.forEach(g=>{const y=l.encode(g[1]).buffer;o.push(y),r.push({pageNumber:g[0],examId:this.examName,value:y})}),postMessage({msg:a.msg,uid:a.uid,payload:r},o)}finally{this.close()}}getNonAlignSortByPageNumber(e,a){this.initDb(e);try{const t=this.db.selectArrays("select page,imageData from nonalign order by page asc"),n=[],r=new TextEncoder,l=[];t.forEach(o=>{const g=r.encode(o[1]).buffer;l.push(g),n.push({pageNumber:o[0],examId:this.examName,value:g})}),postMessage({msg:a.msg,uid:a.uid,payload:n},l)}finally{this.close()}}getAlignSortByPageNumber(e,a){this.initDb(e);try{const t=this.db.selectArrays("select page,imageData from align order by page asc"),n=[],r=new TextEncoder,l=[];t.forEach(o=>{const g=r.encode(o[1]).buffer;l.push(g),n.push({pageNumber:o[0],examId:this.examName,value:g})}),postMessage({msg:a.msg,uid:a.uid,payload:n},l)}finally{this.close()}}addExam(e,a){try{this.initemptyDb(e)}finally{postMessage({msg:a.msg,uid:a.uid})}}getExamTimestamp(e,a){this.initDb(e);try{const t=this.db.selectValue("select DT from exam where id=1");postMessage({msg:a.msg,uid:a.uid,payload:new Date(t).getTime()})}finally{this.close()}}countNonAlignWithPageNumber(e,a){const t=a.payload;this.initDb(e);try{const n=this.db.selectValue("select count(*) from nonalign where page="+t.pageInscan);postMessage({msg:a.msg,uid:a.uid,payload:n})}finally{this.close()}}countAlignWithPageNumber(e,a){const t=a.payload;this.initDb(e);try{const n=this.db.selectValue("select count(*) from align where page="+t.pageInscan);postMessage({msg:a.msg,uid:a.uid,payload:n})}finally{this.close()}}moveNonAlignPages(e,a){const t=a.payload;if(this.initDb(e),t.from!==t.to)try{const n=this.db.selectValue("update nonalign  set page=-1000 where page="+t.from);this.db.selectValue(t.from<t.to?"update nonalign  set page=page-1 where page>"+t.from+" and page<="+t.to:"update nonalign  set page=page+1 where page<"+t.from+" and page>="+t.to),this.db.selectValue("update nonalign set page="+t.to+" where page=-1000"),postMessage({msg:a.msg,uid:a.uid,payload:n})}finally{this.close()}else postMessage({msg:a.msg,uid:a.uid,payload:0})}moveAlignPages(e,a){const t=a.payload;if(this.initDb(e),t.from!==t.to)try{const n=this.db.selectValue("update align  set page=-1000 where page="+t.from);this.db.selectValue(t.from<t.to?"update align  set page=page-1 where page>"+t.from+" and page<="+t.to:"update align  set page=page+1 where page<"+t.from+" and page>="+t.to),this.db.selectValue("update align set page="+t.to+" where page=-1000"),postMessage({msg:a.msg,uid:a.uid,payload:n})}finally{this.close()}else postMessage({msg:a.msg,uid:a.uid,payload:0})}removePageAlignForExamForPagesAndReorder(e,a){const t=a.payload;this.initDb(e);const n=t.pages;try{const r=this.db.selectValue("select count(*) from align");this.db.exec("delete from align where page IN ("+n.join(",")+")");const l=n.sort((o,g)=>o-g);for(let o=0;o<n.length;o++){let g=r,y=!0;o<l.length-1&&(g=l[o+1],y=!1);const x=l[o];x!==g&&this.db.selectValue(y?"update align  set page=page-"+(o+1)+" where page>"+x+" and page<="+g:"update align  set page=page-"+(o+1)+" where page>"+x+" and page<"+g)}postMessage({msg:a.msg,uid:a.uid})}finally{this.close()}}removePageNonAlignForExamForPagesAndReorder(e,a){const t=a.payload;this.initDb(e);const n=t.pages;try{const r=this.db.selectValue("select count(*) from nonalign");this.db.exec("delete from nonalign where page IN ("+n.join(",")+")");const l=n.sort((o,g)=>o-g);for(let o=0;o<n.length;o++){let g=r,y=!0;o<l.length-1&&(g=l[o+1],y=!1);const x=l[o];x!==g&&this.db.selectValue(y?"update nonalign  set page=page-"+(o+1)+" where page>"+x+" and page<="+g:"update nonalign  set page=page-"+(o+1)+" where page>"+x+" and page<"+g)}postMessage({msg:a.msg,uid:a.uid})}finally{this.close()}}moveTemplatePages(e,a){const t=a.payload;if(this.initDb(e),t.from!==t.to)try{const n=this.db.selectValue("update template  set page=-1000 where page="+t.from);this.db.selectValue(t.from<t.to?"update template  set page=page-1 where page>"+t.from+" and page<="+t.to:"update template  set page=page+1 where page<"+t.from+" and page>="+t.to),this.db.selectValue("update template set page="+t.to+" where page=-1000"),postMessage({msg:a.msg,uid:a.uid,payload:n})}finally{this.close()}else postMessage({msg:a.msg,uid:a.uid})}removePageTemplateForExamForPage(e,a){const t=a.payload;this.initDb(e);try{this.db.exec("delete from template where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:a.msg,uid:a.uid,payload:{}})}finally{this.close()}}}}},D={};function c(p){var b=D[p];if(void 0!==b)return b.exports;var u=D[p]={exports:{}};return w[p](u,u.exports,c),u.exports}c.m=w,c.x=()=>{var p=c.O(void 0,[592],()=>c(33827));return c.O(p)},p=[],c.O=(b,u,f,d)=>{if(!u){var h=1/0;for(i=0;i<p.length;i++){for(var[u,f,d]=p[i],v=!0,I=0;I<u.length;I++)(!1&d||h>=d)&&Object.keys(c.O).every(t=>c.O[t](u[I]))?u.splice(I--,1):(v=!1,d<h&&(h=d));if(v){p.splice(i--,1);var N=f();void 0!==N&&(b=N)}}return b}d=d||0;for(var i=p.length;i>0&&p[i-1][2]>d;i--)p[i]=p[i-1];p[i]=[u,f,d]},c.d=(p,b)=>{for(var u in b)c.o(b,u)&&!c.o(p,u)&&Object.defineProperty(p,u,{enumerable:!0,get:b[u]})},c.f={},c.e=p=>Promise.all(Object.keys(c.f).reduce((b,u)=>(c.f[u](p,b),b),[])),c.u=p=>"common.ebd45ad1caaf7f0e.js",c.miniCssF=p=>{},c.o=(p,b)=>Object.prototype.hasOwnProperty.call(p,b),c.j=827,(()=>{var p;c.tt=()=>(void 0===p&&(p={createScriptURL:b=>b},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(p=trustedTypes.createPolicy("angular#bundler",p))),p)})(),c.tu=p=>c.tt().createScriptURL(p),c.p="",(()=>{var p={827:1};c.f.i=(d,i)=>{p[d]||importScripts(c.tu(c.p+c.u(d)))};var u=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],f=u.push.bind(u);u.push=d=>{var[i,h,v]=d;for(var I in h)c.o(h,I)&&(c.m[I]=h[I]);for(v&&v(c);i.length;)p[i.pop()]=1;f(d)}})(),(()=>{var p=c.x;c.x=()=>c.e(592).then(p)})(),c.x()})();